<html>

<head>
    <meta charset="UTF-8" />

    <title>CartoBike</title>

    <link href="css/style.css" type="text/css" rel="stylesheet">

    <script type="text/javascript" src="js/config.js"></script>
    <!--<script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.core.js"></script>-->

    <script type="text/javascript">
        var map /*, url_bikesharing*/ ;
        $(document).ready(function() {

            //url_bikesharing = "ch.bfe.bikesharing";

            /*-------------------------------------------
            Ex 1 — Première couche de référence: Satellite map
            -------------------------------------------*/
            var satelliteMap = new ol.layer.Tile({
                title: 'SatelliteMap',
                type: "base",
                source: new ol.source.BingMaps({
                    key: 'AqE05oJsq-bWa50FPOW2S0eQm9Oqqygc1VTi_WPhUIoKR_-jgA559CRbfndgWAIz',
                    imagerySet: 'Aerial'
                })
            });

            /*-------------------------------------------
            Ex 1 — Deuxième couche de référence: Frontière de la Suisse
            -------------------------------------------*/
            // style ne fonctionne pas!!!
            // => http://www.rhone-mediterranee.eaufrance.fr/milieux-aquatiques/poissons/js/openlayers-v3.19.1/apidoc/ol.layer.Tile.html
            var frontiereSuisseStyle = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#004000',
                    width: 1
                })
            });

            var frontiereSuisse = new ol.layer.Tile({
                title: "FrontiereSuisse",
                source: new ol.source.TileWMS({
                    url: "https://wms.geo.admin.ch",
                    params: {
                        VERSION: "1.1.1",
                        LAYERS: "ch.swisstopo.swissboundaries3d-land-flaeche.fill",
                        FORMAT: "image/png"
                    }
                }),
                style: frontiereSuisseStyle,
                //opacity: 0.5
            });

            // Centre au milieu de la Suisse
            var center = ol.proj.transform([8.2, 46.8], 'EPSG:4326', 'EPSG:3857');
            var view = new ol.View({
                center: center,
                zoom: 7.7
            });

            map = new ol.Map({
                target: 'map',
                layers: [
                    satelliteMap,
                    frontiereSuisse
                ],
                view: view
            });

            /*-------------------------------------------
            Ex 2 — Première couches en superpositions qui viennent enrichir la visualisation en pertinence avec la thématique: Pistes cyclables
            -------------------------------------------*/
            // trouver seulement pour Zurich

            /*-------------------------------------------
            Ex 2 — Deuxième couches en superpositions qui viennent enrichir la visualisation en pertinence avec la thématique: Routes (voiture)
            -------------------------------------------*/

            /*-------------------------------------------
            Ex 2 — Deuxième couches en superpositions qui viennent enrichir la visualisation en pertinence avec la thématique: Noms de rues
            -------------------------------------------*/


            /*new ol.layer.Tile({
            title: "BikeSharing",
            source: new ol.source.TileWMS({
                url: chWMS,
                params: {
                    VERSION: "1.0.0",
                    LAYERS: url_bikesharing,
                    FORMAT: "image/png",
                    opacity: 0.5
                    }
                })
            })*/


            /*var mapConfig = {
                'layers': [{
                    'type': 'cartodb',
                    'options': {
                        //'cartocss_vesrion': '2.1.1',
                        //'cartocss':
                        'sql': 'SELECT * FROM ch_bfe_bikesharing_fr'
                    }
                }]
            };

            var bikeLyr = new ol.layer.Tile({
                source: new ol.source.CartoDB({
                    account: 'juanmorenoheig',
                    config: mapConfig
                })
            });
            map.addLayer(bikeLyr);*/

            /*-------------------------------------------
            Ex 3 — Première couche en super superposition de type vector et les possibilités d'interaction avec celle-ci
            -------------------------------------------*/

            var q = "select*from%20public.ch_bfe_bikesharing_fr";
            var fromat = "GeoJSON";
            var key = "a1a59d709941fb82f30fafa226924d04a23ba185";

            function createBikeShareStyle(feature, resolution) {
                var styleBikeShare = new ol.style.Style({
                    image: new ol.style.Icon({
                        src: "https://data.geo.admin.ch/ch.bfe.bikesharing/images/" + feature.get('idsystem') + "_bike.png",
                        anchor: [0.5, 1]
                    })
                });
                console.log(feature.get('idsystem'));
                return styleBikeShare;
            };

            var bikeLyr = new ol.layer.Vector({
                title: "BikeSharing",
                source: new ol.source.Vector({
                    url: "https://juanmorenoheig.carto.com/api/v2/sql?q=" + q + "&format=" + fromat + "&api_key=" + key,
                    format: new ol.format.GeoJSON()
                }),
                style: createBikeShareStyle
            });
            map.addLayer(bikeLyr);

            // COMMENT FAIRE UNE EVENT SUR CLICK SUR UN BIKE POUR AFFICHER INFO

            /*map.on('singleclick', function (evt) {
                var wmsSource = bikeLyr.getSource();

                // WMS GetFeatureInfo request generator
                var url = wmsSource.getGetFeatureInfoUrl(
                        // clic context
                        evt.coordinate,
                        // map context
                        map.getView().getResolution(),
                        "EPSG:3857",
                        {
                            //INFO_FORMAT: "text/html"
                            INFO_FORMAT: "application/json"
                        }
                );
                if (url) getFeatureInfo(url);
            });*/




            /*var bikeWmsLayer = new ol.layer.Tile({
                    source: new ol.source.TileWMS({
                        url: chWMS,
                        ratio: 1,
                        params: {
                            VERSION: "1.0.0",
                            LAYERS: url_bikeshareing,
                            FORMAT: "image/png"
                        }
                    })
                });
                
                map.addLayer(bikeWmsLayer);*/



        })

    </script>
</head>

<body>
    <header>
        <h1>CartoBike</h1>
        <p>This application is intended for users of rental bicycles.</p>
    </header>

    <div class="container">
        <div class="left">
            <h3 class="containerHead">Map</h3>
            <div class="containerContenu">
                <div id="map"></div>
            </div>
        </div>

        <div class="right">
            <h3 class="containerHead">Settings</h3>
            <div class="containerContenu">
                <!--<div id="info"></div>-->
            </div>
        </div>
        
        <div class="right">
            <h3 class="containerHead">Informations</h3>
            <div class="containerContenu">
                <!--<div id="info"></div>-->
            </div>
        </div>
        
    </div>

    <footer>
        <p>Application by Juan Moreno and Stefanie Schlumpf   |   GÉOINF 18/19</p>
    </footer>
</body>

</html>
